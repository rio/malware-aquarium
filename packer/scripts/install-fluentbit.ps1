Invoke-WebRequest -Uri "https://fluentbit.io/releases/1.9/fluent-bit-1.9.4-win64.exe" -OutFile "c:\Windows\Temp\fluent-bit-1.9.4-win64.exe" 

C:\Windows\Temp\fluent-bit-1.9.4-win64.exe /S /D="C:\fluent-bit"

Start-Sleep -Seconds 90

Set-Content -Path "C:\fluent-bit\conf\fluent-bit.conf" -Value "
[SERVICE]
    # Flush
    # =====
    # set an interval of seconds before to flush records to a destination
    flush        5

    # Daemon
    # ======
    # instruct Fluent Bit to run in foreground or background mode.
    daemon       Off

    # Log_Level
    # =========
    # Set the verbosity level of the service, values can be:
    #
    # - error
    # - warning
    # - info
    # - debug
    # - trace
    #
    # by default 'info' is set, that means it includes 'error' and 'warning'.
    log_level    info

    # Parsers File
    # ============
    # specify an optional 'Parsers' configuration file
    parsers_file parsers.conf

    # Plugins File
    # ============
    # specify an optional 'Plugins' configuration file to load external plugins.
    plugins_file plugins.conf

    # HTTP Server
    # ===========
    # Enable/Disable the built-in HTTP Server for metrics
    http_server  Off
    http_listen  0.0.0.0
    http_port    2020

    # Storage
    # =======
    # Fluent Bit can use memory and filesystem buffering based mechanisms
    #
    # - https://docs.fluentbit.io/manual/administration/buffering-and-storage
    #
    # storage metrics
    # ---------------
    # publish storage pipeline metrics in '/api/v1/storage'. The metrics are
    # exported only if the 'http_server' option is enabled.
    #
    storage.metrics on

[INPUT]
    Name         winevtlog
    Channels     Setup,Windows PowerShell,Application,Security,System,Microsoft-Windows-SMBClient/Connectivity,Microsoft-Windows-Sysmon/Operational,Microsoft-Windows-SMBServer/Connectivity,Microsoft-Windows-SMBServer/Operational
    Interval_Sec 1
    DB           winevtlog.sqlite

[OUTPUT]
    name    gelf
    match   *
    host    graylog-headless.graylog.svc.cluster.local
    mode    tcp
    port    12201
    gelf_short_message_key  Message
    gelf_host_key  Computer

# [OUTPUT]
#     name    syslog
#     match   *
#     host    graylog-headless.graylog.svc.cluster.local
#     port    8514
#     mode    tcp
#     syslog_message_key  Message
#     syslog_hostname_key  Computer

[OUTPUT]
    name    loki
    match   *
    host    loki-headless.loki.svc.cluster.local
    labels  job=fluentbit,host=`$Computer,provider_name=`$ProviderName,channel=`$Channel"

New-Service fluent-bit -BinaryPathName '"C:\fluent-bit\bin\fluent-bit.exe" -c "C:\fluent-bit\conf\fluent-bit.conf"' -StartupType Automatic