# See here for image contents: https://github.com/microsoft/vscode-dev-containers/tree/v0.245.2/containers/debian/.devcontainer/base.Dockerfile

# [Choice] Debian version (use bullseye on local arm64/Apple Silicon): bullseye, buster
ARG VARIANT="buster"
FROM mcr.microsoft.com/vscode/devcontainers/base:0-${VARIANT}

# ** [Optional] Uncomment this section to install additional packages. **
# RUN apt-get update && export DEBIAN_FRONTEND=noninteractive \
#     && apt-get -y install --no-install-recommends <your-package-list-here>

COPY --from=ghcr.io/k3d-io/k3d:5.4 /bin/k3d /usr/local/bin/k3d
COPY --from=k8s.gcr.io/kustomize/kustomize:v4.5.5 /app/kustomize /usr/local/bin/kustomize
COPY --from=gcr.io/kpt-dev/kpt:v1.0.0-beta.21 /usr/local/bin/kpt /usr/local/bin/kpt
COPY --from=docker.io/loftsh/vcluster:0.12.2 /vcluster /usr/local/bin/vcluster

RUN curl -sSfLo /usr/local/bin/skaffold https://storage.googleapis.com/skaffold/releases/v1.39.2/skaffold-linux-amd64 && \
    echo '6ecdda952ce8e917dde9a362859952dd1d3ad8ae44b2c56696ec6a89c5d8ce4d  /usr/local/bin/skaffold' | sha256sum -c - && \
    chmod +x /usr/local/bin/skaffold

RUN curl -sSfLo /tmp/chezmoi.tar.gz https://github.com/twpayne/chezmoi/releases/download/v2.22.1/chezmoi_2.22.1_linux_amd64.tar.gz && \
    echo '6ab4593b807e9c2db7536540b00537d61aff00726ff7a6a79e449285f3480b52  /tmp/chezmoi.tar.gz' | sha256sum -c - && \
    tar xf /tmp/chezmoi.tar.gz --directory=/usr/local/bin chezmoi && \
    rm /tmp/chezmoi.tar.gz

RUN curl -sSfLo /tmp/k9s.tar.gz https://github.com/derailed/k9s/releases/download/v0.26.3/k9s_Linux_x86_64.tar.gz && \
    echo '3447ac17cfa46fe91ab2bfcb021d43f7f2d40ac37c7b573241a511b85fc162cf  /tmp/k9s.tar.gz' | sha256sum -c - && \
    tar xf /tmp/k9s.tar.gz --directory=/usr/local/bin k9s && \
    rm /tmp/k9s.tar.gz

RUN usermod --shell $(command -v zsh) vscode